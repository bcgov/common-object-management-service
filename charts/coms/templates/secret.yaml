{{- $bPassword := (randAlphaNum 32) | b64enc }}
{{- $bUsername := (randAlphaNum 32) | b64enc }}
{{- $pPassword := (randAlphaNum 32) | b64enc }}
{{- $pUsername := (randAlphaNum 32) | b64enc }}

{{- $bSecretName := printf "%s-%s" (include "coms.fullname" .) "basicauth" }}
{{- $bSecret := (lookup "v1" "Secret" .Release.Namespace $bSecretName ) }}
{{- $pSecretName := printf "%s-%s" (include "coms.fullname" .) "passphrase" }}
{{- $pSecret := (lookup "v1" "Secret" .Release.Namespace $pSecretName ) }}

{{- if not $bSecret }}
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    "helm.sh/resource-policy": keep
  name: {{ $bSecretName }}
  labels: {{ include "coms.labels" . | nindent 4 }}
type: kubernetes.io/basic-auth
data:
  password: {{ .Values.basicAuthSecretOverride.password | default $bPassword | quote }}
  username: {{ .Values.basicAuthSecretOverride.username | default $bUsername | quote }}
{{- end }}
{{- if not $pSecret }}
---
apiVersion: v1
kind: Secret
metadata:
  annotations:
    "helm.sh/resource-policy": keep
  name: {{ $pSecretName }}
  labels: {{ include "coms.labels" . | nindent 4 }}
type: kubernetes.io/basic-auth
data:
  password: {{ .Values.objectStorageSecretOverride.password | default $pPassword | quote }}
  username: {{ .Values.objectStorageSecretOverride.username | default $pUsername | quote }}
{{- end }}
