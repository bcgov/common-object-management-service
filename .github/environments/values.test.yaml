---
features:
  basicAuth: true
  defaultBucket: false
  oidcAuth: true

autoscaling:
  enabled: true
  maxReplicas: 4

config:
  enabled: true
  configMap:
    BASICAUTH_ENABLED: "true"
    DB_PORT: "5432"
    KC_ENABLED: "true"
    KC_IDENTITYKEY: idir_user_guid,bceid_user_guid
    KC_PUBLICKEY: >-
      MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAiFdv9GA83uHuy8Eu9yiZHGGF9j6J8t7FkbcpaN81GDjwbjsIJ0OJO9dKRAx6BAtTC4ubJTBJMPvQER5ikOhIeBi4o25fg61jpgsU6oRZHkCXc9gX6mrjMjbsPaf3/bjjYxP5jicBDJQeD1oRa24+tiGggoQ7k6gDEN+cRYqqNpzC/GQbkUPk8YsgroncEgu8ChMh/3ERsLV2zorchMANUq76max16mHrhtWIQxrb/STpSt4JuSlUzzBV/dcXjJe5gywZHe0jAutFhNqjHzHdgyaC4RAd3eYQo+Kl/JOgy2AZrnx+CiPmvOJKe9tAW4k4H087ng8aVE40v4HW/FEbnwIDAQAB
    KC_REALM: standard
    KC_SERVERURL: "https://test.loginproxy.gov.bc.ca/auth"
    # SERVER_LOGFILE: ~
    SERVER_LOGLEVEL: http
    SERVER_PORT: "3000"
    SERVER_PRIVACY_MASK: "true"
    SERVER_TEMP_EXPIRESIN: "300"

postgres:
  enabled: true

  # --------------------------------
  # --------crunchydb config: ------
  # --------------------------------

  # --- cluster resource allocation ----
  instances:
    - name: db # do not change this name after initial install, pvc (data) and stateful sets will be deleted
      replicas: 2
      dataVolumeClaimSpec:
        accessModes:
          - "ReadWriteOnce"
        resources:
          requests:
            storage: 2Gi
        storageClassName: "netapp-block-standard"
      resources:
        requests:
          cpu: 1m
          memory: 128Mi
        limits:
          cpu: 100m
          memory: 256Mi

  # ----- pgBouncer (network pooling) ------
  pgBouncerConfig:
    replicas: 3
  # -------- backups ---------
  pgBackRestConfig:
    # allow one-off backups
    manual:
      repoName: repo1
      options:
        - --type=full
    configuration:
      # secret for saving backups to S3
      - secret:
          name: pgbackrest-s3
    global:
      # log-level-console: debug
      # --- pvc
      repo1-retention-full: "3"
      repo1-retention-diff: "12"
      # --- s3
      repo2-path: /backups/common-object-management-service/postgres/test
      repo2-retention-full: "30"
      repo2-s3-uri-style: path
    repos:
      - name: repo1
        schedules:
          full: "0 7 * * *" # full backup every day at 7am
          differential: "0 */2 * * *" # differential every 2 hours
        volume:
          volumeClaimSpec:
            accessModes:
              - "ReadWriteOnce"
            resources:
              requests:
                storage: 2Gi
            storageClassName: "netapp-file-backup"
      - name: repo2
        schedules:
          full: "0 2 * * *" # full backup every day at 2am
        s3:
          bucket: csstops
          endpoint: https://nrs.objectstore.gov.bc.ca
          region: us-east-1
    repoHost:
      resources:
        requests:
          cpu: 1m
          memory: 64Mi
        limits:
          cpu: 50m
          memory: 128Mi
    sidecars:
      pgbackrest:
        resources:
          requests:
            cpu: 1m
            memory: 64Mi
          limits:
            cpu: 50m
            memory: 128Mi
